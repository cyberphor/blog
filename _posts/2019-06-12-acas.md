---
layout: post
title: 'ACAS: Deployment Guide'
permalink: 'acas'
category: notes
---

## Table of Contents
* [VirtualBox](#virtualbox)
  * [Changing the hostname in CentOS](#changing-the-hostname-in-centos)
  * [Configuring 3 DHCP NICs in CentOS](#configuring-3-dhcp-nics-in-centos)
  * [Create an alias in CentOS](#create-an-alias-in-centos)
  * [Install kernel headers in CentOS](#install-kernel-headers-in-centos)
  * [Install VirtualBox Guest Additions for CentOS](#install-virtualbox-guest-additions-for-centos)
  * [Add user to VirtualBox group to access shared folders](#add-user-to-virtualbox-group-to-access-shared-folders)

## VirtualBox
### Changing the hostname in CentOS
```
# step 0
su root

# step 1 (disable this bogus service)
chkconfig NetworkManager off

# step 2 (specify name in file)
vim /etc/sysconfig/network
(update this line) ---> HOSTNAME=<new hostname>

# step 3 (reboot)
reboot now
```

### Configuring 3 DHCP NICs in CentOS
```
# Create a configuration file for each NIC
## I ended up having to use a NAT network, but the same process is necessary
[Host-only] vim /etc/sysconfig/network-scripts/ifcfg-eth0
[Bridged] vim /etc/sysconfig/network-scripts/ifcfg-eth1
[NAT] vim /etc/sysconfig/network-scripts/ifcfg-eth2

# Use the following syntax
NAME=Host-only (or NAT, Bridged)
DEVICE=eth0 (or eth1, eth2)
ONBOOT=yes
BOOTPROTO=dhcp

# Restart the services to bring up the interfaces
service network restart

# References
# https://www.cyberciti.biz/faq/setting-up-a-linux-for-dhcp/
```

### Create an alias in CentOS
```
# Open the appropiate file
vim /etc/bashrc

# Add your alias 
alias cls='clear'
```

### Install kernel headers in CentOS
```
# install the latest headers
yum install kernel-devel

# install the matching kernel
yum install kernel

# ensure the kernel and kernel headers downloaded match
uname -r 
ls /usr/src/kernels/
reboot
```

### Install VirtualBox Guest Additions for CentOS
```
# Ensure you have a valid network connection
ping www.google.com

# Ensure you have kernel headers installed
<see above>

# Update and upgrade
yum update

# Install the "gcc, make, and perl" libraries
yum install gcc make perl

# Identify the directory where the scripts are mounted to 
mount | grep VBox
cd /path/to/VBox/scripts/

# Run the Vbox script for Linux from the correct directory
./VBoxLinuxAdditions.run
reboot

# Manually change the resolution if desired

# References
# http://ask.xmodulo.com/install-kernel-headers-linux.html
```

### Add user to VirtualBox group to access shared folders
```
# Verify the name of the group
cat /etc/group

# Add user to the proper group
su root
usermod -a -G vboxsf

# Logout of the shell/GUI
```

## How to setup an ACAS server
```
# Install CentOS 6.9 (I used VirtualBox)
http://archive.kernel.org/centos-vault/6.9/isos/x86_64/CentOS-6.9-x86_64-LiveDVD.iso

# Install ACAS using .tar file from DISA (link requires CAC login)
https://patches.csd.disa.mil/CollectionInfo.aspx
yum install CM-235553-SecurityCenter-5.8.0-el6.x86_64.rpm -y
# it will now be accessible via https://localhost

# Install and start Nessus using .tar file from DISA (link requires CAC login)
yum install CM-238325-Nessus-7.2.2-es6.x86_64.rpm -y
service nessud start

# How to un-install SecurityCenter (for t-shooting purposes)
yum list | grep -i SecurityCenter
yum remove SecurityCenter*
for file in $(rpm -q --config SecurityCenter); do rm -f $file; done && rpm -e SecurityCenter
# Reference
# https://serverfault.com/questions/41502/yum-equivalent-of-apt-get-purge

# How to un-install Nessus (for t-shooting purposes)
yum list | grep -i Nessus
yum remove Nessus*

# Access ACAS SecurityCenter 
# https://localhost
# run `netstat -pant` to verify there is a port open for ACAS
## Supply the <license-matching-your-hostname>.key file

# Configure an ACAS Nessus Scanner
- Name: scanner01
- Host: 192.168.56.106 (Host-only IP for personal lab environment)
- Port: 8834
- Username: victor (must match the user you create when you setup Nessus)
- Password: <password>

# Configure a Repository
- Name: repo01
- Description: "Nodes within my (Host-only) virtual lab"
- IP ranges: 192.168.56.0/

# Configure an Organization
- Name: organization01
- Description: "..."

# Configure a SecurityManager (255S)
- First Name: Victor
- Last Name:  Fernandez
- Username: victor
- Password: <password>
- Administrator (255A): <password>
- # username for default admin is "admin"

# Start Nessus scanner
service nessusd start

# Setup Nessus Scanner (change IP/URL to where it's located; ex: localhost)
# access via https://localhost:8834http
- Username: victor
- Password: <password>
- Scanner Type: Managed By SecurityCenter
```

**Hand-on Practical Exercise #1**
1. Download Windows 10 VM
2. Install Wireshark
3. Install SCAP Compliance Checker (SCC)
4. Run local SCC scan (ends by presenting a URL to the view scan results)
5. "STIG" the VM as much as possible (?)
6. Login to schoolhouse ACAS server (https://acas.train.net; student10; 1qazxsw2!QAZXSW@)
7. Review date/time of last plugin feed update
	- Click-on your username > Plugins > Look at Modified column
8. Create a scan
	- Create a plan first; specify the following (in order):
		- Credentials: Windows: Password (use VM username/password)
		- File (if applicable)
		- Policy: Basic Network Scan (use default options for this demo)
		- Scan: Active Scan
			- Policy: the one created
			- Import Repository (under Settings): Classroom101
			- Targets: VM IP
9. Setup Wireshark to watch the scan
	- `ip.addr==10. 120.2.40 and ip.addr==10.25.5.72`
10. Disable firewall of VM (below uses the relevant PowerShell Cmdlet)
	- `Set-NetFirewallProfile -Profile domain,private,public -Enabled false`
11. Start the "Remote Registry" service in the VM
	- `<cmd to start the service>`
12. Start the scan (watch via Wireshark within the VM)
13. Disable "User Account Control (UAC)" by using the Control Panel or by adding a Registry key
	- Create the following DWORD with a value set to 1
	- HKEY_LOCAL_MACHINE = HKLM
	- `New-Item -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\ -Name LocalAccountTokenFilterPolicy -Force`
	- `Set-Item -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy -Value “1”`
14. Re-enable the firewall (using the same PowerShell Cmdlet)
	- `Set-NetFirewallProfile -Profile domain,private,public -Enabled True`
15. Create a new Audit File, Policy, and Scan
	- Audit File: Windows > DISA Windows 10 STIG v1r14
	- Policy: SCAP and OVAL Auditing
		- Compliance: Use the Audit File you uploaded
	- Scan: Active Scan
		- Policy: use the new policy you created
		- Import Repository (under Settings): Classroom101
		- Targets: VM IP
		- Credentials: Windows: the one you created
16. Update your firewall to allow the ACAS server IP address 
	- `New-NetFirewallRule -DisplayName AllowACASInbound -Direction Inbound -LocalAddress 192.168.56.6 -RemoteAddress 192.168.56.7 -Profile Domain,Private,Public -Protocol Any -LocalPort Any -Action Allow -Enabled True`
	- `New-NetFirewallRule -DisplayName AllowACASOutbound -Direction Outbound -LocalAddress 192.168.56.7 -RemoteAddress 192.168.56.6 -Profile Domain,Private,Public -Protocol Any -LocalPort Any -Action Allow -Enabled True`
17. Run the SCAP and OVAL Auditing scan you just created 
18. Export the results
	- Options > Export as CSV
19. [Optional step] Install Java (for DISA STIG Viewer)
20. Modify your Audit File
	- [File] Scans > Audit Files > Add > Advanced > Audit File > Select "U_MS_Windows_10_V1R14_STIG_SCAP_1-2_Benchmark.zip"
		- Download different benchmarks from DISA (ex: Google Chrome benchmark) and import them as Audit Files
	- [Policy] Scans > Policies > Add > SCAP and OVAL Auditing (Compliance: SCAP Windows > NewAuditFile)
	- [Scan] Scans > Active Scans > Add > (Policy: NewAuditPolicy, Targets: VM, Credentials: Windows, )
21.  Run, export results, and import into the DISA STIG Viewer
	- [ACAS menu] Scans > Scan Results > Gear icon > Download SCAP XML > Extract All	
	- [DISA STIG Viewer: STIG Explorer tab] Import the "MS Windows 10 v1r14 STIIG" file 
	- [DISA STIG Viewer: STIG navigation bar] Checklist > Create Checklist - Check Marked STIG(s)
		- Import > XCCDF File > Browse to extracted scan results folder

STIG-related Resources
- DISA STIG Viewer: https://public.cyber.mil/stigs/stig-viewing-tools/
- LGPO (download the LGPO.zip): https://www.microsoft.com/en-us/download/details.aspx?id=53319
	- Converts GPOs to local policies (ADMX/ADML files)
		- Convert GPOs to the ADMX/ADML file format 
			- `LGPO.exe /g ../"DOD Google Chrome v1r15"`
		- Then, copy them into C:\Windows\PolicyDefintions\
			- This provides the setting requirements specified by DISA STIGs
				- ex: Google Chrome will 
- Link to STIG GPO: https://dl.cyber.mil/stigs/zip/U_STIG_GPO_Package_April_2019.zip

How to enable the Windows Firewall dropped packets log
- Control Panel > Windows Defender Firewall > Advanced settings > Windows Defender Firewall Properties
	- Domain, Private, Public Profile: Logging > Customize... 
		- Log dropped packets: Yes

**Hands-on Practical Exercise #2**
```
# Setup
# Ensure you can ping the Windows 10 client (add firewall rule if necessary)
# Ensure the User Account Control (UAC) is disabled via a special Registry key
# Ensure the REMOTE REGISTRY service is ENABLED

# Create Credentials
Scans > Credentials > Add > Windows: Password
	- Name: Credential_Windows10_Client
	- Password Credential
		- Username: victor
		- Password: <password>

# Upload an Audit File
## You can download benchmarks/STIGs from...
Scans > Audit Files > Add > Custom
	- Name: AuditFile_DISA_Windows10_STIG_v1r14_Benchmark

# Create a Policy
Scans > Policies > Add > SCAP and OVAL Auditing
	- Name: Policy_DISA_Windows10_STIG_v1r14
	- Compliance: Use the Audit File you uploaded
		- Type: Windows
		- Audit File: DISA_Windows10_STIG_v1r14_auditFile

# Create and start an Active Scan
Scans > Active Scans > Add > 
		- Name ActiveScan_DISA_Windows10_v1r14
		- Policy: Policy_DISA_Windows10_STIG_v1r14 (the policy you created)
		- Import Repository: repo01
		- Targets: 192.168.56.7 (Windows 10 VM IP address)
		- Credentials: Credential_Windows10_Client (the one you created)

# Upload offline plugins (you're using a Stand-Alone system)
# You can offline plugins from...
- Login to SecurityCenter as "admin"
- System > Configuration > Plugins/Feed
	- Expand on the SecurityCenter Feed and upload the SecurityCenter file (.tar.gz file)
		- Click-on Submit
	- Expand on the Active Plugins and upload the relevant files (.tar.gz files)
		- Click-on Submit
- Restart your Nessus daemon
	- service nessud restart
	- Login to the Nessus scanner (you should see it compiling your new plugins)

 Perform a scan
```

**ACAS Roles**
- Administrator (255A) = manages users & groups
- Security manager (255S) = manages scans, blackout windows, updating plugins, etc and other users (except admins)
- Security analyst (25D) = manages scans, etc. but CANNOT manage users
- Auditor (255S at an RCC level org) = checks if scan activities are being done correctly
- Executive (25/26/17A) = can read high-level view of reports 

- ACAS is a Program of Record (managed by DISA)
- Every unit should have an ACAS server
- ACAS (SecurityCenter) software licenses are managed by DISA
	- https://disa.deps.mil/extcop/mae/netops/acas/Lists/ACAS_License_Request/Submit.aspx
	- Submit a form (type of license; unit)
	- License expires after a year
- Usually installed on Red Hat (which requires another license, a unit responsibility)
	- CentOS is an alternative (but not the newest version, 7)
	- Can download a Red Hat VM from DISA with ACAS pre-installed 

ACAS is a collection vulnerability, port, and patch compliance scanners
- SecurityCenter (SC) = web interface to manage/execute ACAS functions
	- WIN-T increment 1b = 1 SC per BDE 
- Nessus Scanner = establish one per scanner
	- Downloaded plugin feeds must be younger than 7 days in order to be within DoD compliance
	- WIN-T increment 1b = 1 SC per BDE
	- WIN-T increment 1b = 1 SC per BN
- Passive Vulnerability Scanner (PVS) = a sensor (like tcpdump, snort)
	- Not really used (was also replaced with a similar tool)

Doctrine mandating the use of ACAS
- Task order 13-670
- Task order 14-0294
- DISA's ACAS TTP

## Overview of ACAS
* DISA published Request For Proposal in 2013 to replace Retina Scanner
* HP responded with Nessus Scanner, Passive Vulnerability Scanner, & SecurityCenter 

**ACAS can scan for:**
* Vulnerabilities (app, system, network)
* Device configuration
* Network discovery
* Compliance with SCAP (Security Content Automation Protocol)

**ACAS Components**
* SecurityCenter
    * Uses 8835 to connect to SecurityCenter 
    * GUI; central console for ACAS and data; where to update plugins
* Nessus Scanner
    * Uses 8834
    * Active passive scanner
    * Compliance scanner (STIG, SCAP, etc.)
    * Scans data at rest
* Passive Vulnerability Scanner
    * Uses 8835 to connect to SecurityCenter 
    * Sniffs network for traffic via tap/span port; continuous monitoring solution
    * Uses scripts/plugins to detect vulnerabilities on the network passively
    * Scans data in transit/motion
* 3D
    * Uses 443 (can change)
    * Relies on pre-built queries to generate visuals of vulnerabilities (like Kibana)
    * Password-based authentication; if you require CAC, can't login

**ACAS functions**
* Discover assets via Ping, port scanners, traceroute, TTLs
* Vulnerabilities are tied to the script/plugins that find them
    * Vulns come from poor configuration (unneeded ports open), implementation (buffer overflows), or design (IP, Telnet, etc)
    * ACAS plugins are developed by DISA using info from Tenable (via Bugtraq, OSVDB, CVE)

**ACAS Task Orders**
* Task Order 13-670 Implementation of ACAS for the Enterprise
* Task Order 14-0294 IAVM Reporting Compliance Using CMRS
* DISA's ACAS Tactics, Techniques, and Procedures

## SecurityCenter 5.3
**How to Change Your Default Timezone**
1. Click-on Username drop-down menu
2. Click-on Profile
3. Click-on preferred Time Zone

# Menus
* Navigation bar
    * Dashboard: first button upon login
    * Analysis: 
        * Vulnerabilities
        * Events: not supported by DISA right now; for log correlation 
        * Mobile: MDM servers
        * Queries: saved filters
    * Scans
        * Active scans: vulnerability scan, compliance scans
        * Agent scans
        * Scan results
        * Policies: how scan will run (plugins, ports to scan, performance options)
        * Audit files: compliance docs (.xml files with STIG checks)
        * Credentials: for login to host being scanned (SSH)
        * Blackout windows: set "do not scan" during these windows (or assets at certain times)
    * Reporting
        * Reports
        * Report Results
        * Report Images: company logos
        * Report Attributes: scan data destined for CMRS (continuous monitoring risk score)
    * Workflow
        * Alerts: scan for specific vulnerability, if found, send an alert to someone
        * Tickets: lightweight system for issue management
        * Accept Risk Rules: mark a vulnerability as accepted
        * Recast Risk Rules: 
    * Users
        * Users:
        * Roles: "what I can do"
        * Groups: "what I can see"
* Username drop-down menu
    * About: SecurityCenter version
    * System Logs: login events, filter by severity, etc.
    * Profile: change password, change Time Zone
        * Responsibility: designate Assets by admin name ("Vic is responsible for Linux Hosts")
    * Feeds: can connect to DISA or DoD patch repo for the latest plugins (downloaded as tar/zip files)
    * Notifications
    * Plugins: can write & upload custom scripts/plugins using Nessus Attack Scripting Language (NASL) using top-right button; plugin update time can be viewed here and in Feeds
    * Help
    * Logout

# SecurityCenter Building Blocks
* Structure (within a single instance of SecurityCenter)
    * roles per org (group of people responsible for common assets): 1 admin, 2 security managers, 4 analysts 
    * structure designs: based on mission (directorate 1, directorate 2, tactical); CONUS/OCONUS; report authority (ARCENT v CENTCOM) 
* Role, Group, User definitions
    * Role: functional permissions
    * Group: access controls
    * Users: user details/assignments
* Scan Zone (and Nessus Scanners)
    * Scan Zone = specified subnet in SecurityCenter (if you select an IP to scan, SecurityCenter will select the appropriate Nessus Scanner based on the Scan Zone) 

## Repos, Zones, and Plugins
* Repository: folder with text-based scan files (containing IP addresses of hosts to scan). 
    * Max-size is 32GBs
* Zones: area where scans are performed
* Admin manages Repos, Zones, and Plugins
    * ex: Zone 1 references Repo A (a text-file with IPs) to know who to scan
    * can add multiple IP ranges to a single Repo (so more than one Zone can use it)
    * Repos are individual from Zones
* Plugins
    * How do you get your plugins?
        * Vendor > DISA > DISA Plugin Server > Scheduled pull > SecurityCenter > Auto push > Nessus scanner
    * How to search for plugins
        * Can search for by Plugin family (MS Bulletins, device type, etc.)
        * Can search by CVE ID, Bugtraq ID (BID), Name, etc. 
            1.  Select "Name" by drop-down menu
            2. Type keyword
            3. Click-on **Apply**
    * Plugin Ids (click on the "i" button to view source-code of plugins/scripts)
        * Passive scanning plugins (PVS): 1-10,000 
        * Active/Nessus plugins: 10,001-900,000 
        * Custom plugins: 900,001-999,999 
        * Compliance plugins: 1,000,000+ 

## Scanning a Stand-Alone network
* Option 1: Install Nessus and SecurityCenter on RHEL laptop via Kickstart
    * Easy deployment; faster than Windows version of Nessus
* Option 2: RHEL VMs (Nessus, SecurityCenter) on Windows laptop
    * Can use Windows browser to access SecurityCenter
* Option 3: Detach Nessus Scanner from ACAS system for Stand-Alone network
    * Must re-attach scanner (RHEL laptop) to get plugin updates
    * Miss out on full functionality
